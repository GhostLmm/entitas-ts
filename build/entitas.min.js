var entitas;!function(t){var e;!function(t){"use strict";var e=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],n=function(){function t(){}return t.randomUUID=function(){var t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0,o=4294967295*Math.random()|0;return e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255]+"-"+e[255&n]+e[n>>8&255]+"-"+e[n>>16&15|64]+e[n>>24&255]+"-"+e[63&i|128]+e[i>>8&255]+"-"+e[i>>16&255]+e[i>>24&255]+e[255&o]+e[o>>8&255]+e[o>>16&255]+e[o>>24&255]},t}();t.UUID=n}(e=t.utils||(t.utils={}))}(entitas||(entitas={}));var entitas;!function(t){var e;!function(t){"use strict"}(e=t.utils||(t.utils={}))}(entitas||(entitas={}));var __extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},entitas;!function(t){var e;!function(t){"use strict";var e=function(t){function e(e){void 0===e&&(e=64),t.call(this),this.size_=0,this.length=e}return __extends(e,t),e.prototype.removeAt=function(t){var e=this[t];return this[t]=this[--this.size_],this[this.size_]=null,e},e.prototype.remove=function(t){var e,n,i=this.size_;for(e=0;e<i;e++)if(n=this[e],t==n)return this[e]=this[--this.size_],this[this.size_]=null,!0;return!1},e.prototype.removeLast=function(){if(this.size_>0){var t=this[--this.size_];return this[this.size_]=null,t}return null},e.prototype.contains=function(t){var e,n;for(e=0,n=this.size_;n>e;e++)if(t===this[e])return!0;return!1},e.prototype.removeAll=function(t){var e,n,i,o,s,r=!1;for(e=0,i=t.size();e<i;e++)for(o=t.get(e),n=0;n<this.size_;n++)if(s=this[n],o===s){this.removeAt(n),n--,r=!0;break}return r},e.prototype.get=function(t){if(t>=this.length)throw new Error("ArrayIndexOutOfBoundsException");return this[t]},e.prototype.safeGet=function(t){return t>=this.length&&this.grow(7*t/4+1),this[t]},e.prototype.size=function(){return this.size_},e.prototype.getCapacity=function(){return this.length},e.prototype.isIndexWithinBounds=function(t){return t<this.getCapacity()},e.prototype.isEmpty=function(){return 0==this.size_},e.prototype.add=function(t){this.size_===this.length&&this.grow(),this[this.size_++]=t},e.prototype.set=function(t,e){t>=this.length&&this.grow(2*t),this.size_=t+1,this[t]=e},e.prototype.grow=function(t){void 0===t&&(t=~~(3*this.length/2)+1),this.length=~~t},e.prototype.ensureCapacity=function(t){t>=this.length&&this.grow(2*t)},e.prototype.clear=function(){var t,e;for(t=0,e=this.size_;t<e;t++)this[t]=null;this.size_=0},e.prototype.addAll=function(t){var e;for(e=0;t.size()>e;e++)this.add(t.get(e))},e}(Array);t.Bag=e}(e=t.utils||(t.utils={}))}(entitas||(entitas={}));var entitas;!function(t){var e;!function(e){"use strict";var n=t.utils.Bag,i=function(){function t(t,e){void 0===e&&(e=16),this._listeners=new n,this._context=t,this._alloc=e,this.active=!1}return t.prototype.dispatch=function(t,e,n,i,o){var s=this._listeners,r=s.size();if(!(r<=0))for(var a=this._context,c=0;c<r;c++)s[c].call(a,t,e,n,i,o)},t.prototype.add=function(t){this._listeners.add(t),this.active=!0},t.prototype.remove=function(t){var e=this._listeners;e.remove(t),this.active=e.size()>0},t.prototype.clear=function(){this._listeners.clear(),this.active=!1},t}();e.Signal=i}(e=t.utils||(t.utils={}))}(entitas||(entitas={}));var entitas;!function(t){var e;!function(t){"use strict";var e=function(){function t(){t.isHighRes=!!performance,this.reset()}return Object.defineProperty(t.prototype,"isRunning",{get:function(){return this._isRunning},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"startTimeStamp",{get:function(){return this._startTimeStamp},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"elapsed",{get:function(){return this._elapsed},enumerable:!0,configurable:!0}),t.prototype.start=function(){this._isRunning||(this._startTimeStamp=t.getTimeStamp(),this._isRunning=!0)},t.prototype.stop=function(){this._isRunning&&(this._elapsed+=t.getTimeStamp()-this._startTimeStamp,this._isRunning=!1)},t.prototype.reset=function(){this._elapsed=0,this._startTimeStamp=0,this._isRunning=!1},t.getTimeStamp=function(){return t.isHighRes?performance.now():Date.now()},t.isHighRes=!1,t}();t.Stopwatch=e}(e=t.utils||(t.utils={}))}(entitas||(entitas={}));var entitas;!function(t){"use strict";var e=function(){function t(t){this.message=t}return t.prototype.toString=function(){return this.message},t}();t.Exception=e}(entitas||(entitas={}));var __extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},entitas;!function(t){var e;!function(e){"use strict";var n=t.Exception,i=function(e){function n(n,i){e.call(this,n+"\nEntity already has a component at index ("+i+") "+t.Pool.componentsEnum[i])}return __extends(n,e),n}(n);e.EntityAlreadyHasComponentException=i}(e=t.exceptions||(t.exceptions={}))}(entitas||(entitas={}));var __extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},entitas;!function(t){var e;!function(e){"use strict";var n=t.Exception,i=function(e){function n(n,i){e.call(this,n+"\nEntity does not have a component at index ("+i+") "+t.Pool.componentsEnum[i])}return __extends(n,e),n}(n);e.EntityDoesNotHaveComponentException=i}(e=t.exceptions||(t.exceptions={}))}(entitas||(entitas={}));var __extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},entitas;!function(t){var e;!function(e){"use strict";var n=t.Exception,i=function(t){function e(){t.call(this,"Entity is already released!")}return __extends(e,t),e}(n);e.EntityIsAlreadyReleasedException=i}(e=t.exceptions||(t.exceptions={}))}(entitas||(entitas={}));var __extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},entitas;!function(t){var e;!function(e){"use strict";var n=t.Exception,i=function(t){function e(e){t.call(this,e+"\nEntity is not destroyed yet!")}return __extends(e,t),e}(n);e.EntityIsNotDestroyedException=i}(e=t.exceptions||(t.exceptions={}))}(entitas||(entitas={}));var __extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},entitas;!function(t){var e;!function(e){"use strict";var n=t.Exception,i=function(t){function e(e){t.call(this,e+"\nEntity is not enabled")}return __extends(e,t),e}(n);e.EntityIsNotEnabledException=i}(e=t.exceptions||(t.exceptions={}))}(entitas||(entitas={}));var __extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},entitas;!function(t){var e;!function(e){"use strict";var n=t.Exception,i=function(t){function e(e){t.call(this,e)}return __extends(e,t),e}(n);e.GroupObserverException=i}(e=t.exceptions||(t.exceptions={}))}(entitas||(entitas={}));var __extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},entitas;!function(t){var e;!function(e){"use strict";var n=t.Exception,i=function(t){function e(e){t.call(this,"matcher.indices.length must be 1 but was "+e.indices.length)}return __extends(e,t),e}(n);e.MatcherException=i}(e=t.exceptions||(t.exceptions={}))}(entitas||(entitas={}));var __extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},entitas;!function(t){var e;!function(e){"use strict";var n=t.Exception,i=function(t){function e(e,n){t.call(this,n+"\nPool does not contain entity "+e)}return __extends(e,t),e}(n);e.PoolDoesNotContainEntityException=i}(e=t.exceptions||(t.exceptions={}))}(entitas||(entitas={}));var __extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},entitas;!function(t){var e;!function(e){"use strict";var n=t.Exception,i=function(t){function e(e){t.call(this,"Multiple entities exist matching "+e)}return __extends(e,t),e}(n);e.SingleEntityException=i}(e=t.exceptions||(t.exceptions={}))}(entitas||(entitas={}));var entitas;!function(t){"use strict";var e=function(){function t(t,e){this.trigger=t,this.eventType=e}return t}();t.TriggerOnEvent=e}(entitas||(entitas={}));var entitas;!function(t){"use strict";var e=t.exceptions.MatcherException,n=t.TriggerOnEvent;!function(t){t[t.OnEntityAdded=0]="OnEntityAdded",t[t.OnEntityRemoved=1]="OnEntityRemoved",t[t.OnEntityAddedOrRemoved=2]="OnEntityAddedOrRemoved"}(t.GroupEventType||(t.GroupEventType={}));var i=t.GroupEventType,o=function(){function t(){this._id=t.uniqueId++}return Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"indices",{get:function(){return this._indices||(this._indices=this.mergeIndices()),this._indices},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"allOfIndices",{get:function(){return this._allOfIndices},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"anyOfIndices",{get:function(){return this._anyOfIndices},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"noneOfIndices",{get:function(){return this._noneOfIndices},enumerable:!0,configurable:!0}),t.prototype.anyOf=function(){for(var e=[],n=0;n<arguments.length;n++)e[n-0]=arguments[n];return"number"==typeof e[0]||"string"==typeof e[0]?(this._anyOfIndices=t.distinctIndices(e),this._indices=null,this):this.anyOf.apply(this,t.mergeIndices(e))},t.prototype.noneOf=function(){for(var e=[],n=0;n<arguments.length;n++)e[n-0]=arguments[n];return"number"==typeof e[0]||"string"==typeof e[0]?(this._noneOfIndices=t.distinctIndices(e),this._indices=null,this):this.noneOf.apply(this,t.mergeIndices(e))},t.prototype.matches=function(t){var e=null==this._allOfIndices||t.hasComponents(this._allOfIndices),n=null==this._anyOfIndices||t.hasAnyComponent(this._anyOfIndices),i=null==this._noneOfIndices||!t.hasAnyComponent(this._noneOfIndices);return e&&n&&i},t.prototype.mergeIndices=function(){var e=[];return null!=this._allOfIndices&&(e=e.concat(this._allOfIndices)),null!=this._anyOfIndices&&(e=e.concat(this._anyOfIndices)),null!=this._noneOfIndices&&(e=e.concat(this._noneOfIndices)),t.distinctIndices(e)},t.prototype.toString=function(){if(null==this._toStringCache){var e=[];null!=this._allOfIndices&&t.appendIndices(e,"AllOf",this._allOfIndices),null!=this._anyOfIndices&&(null!=this._allOfIndices&&(e[e.length]="."),t.appendIndices(e,"AnyOf",this._anyOfIndices)),null!=this._noneOfIndices&&t.appendIndices(e,".NoneOf",this._noneOfIndices),this._toStringCache=e.join("")}return this._toStringCache},t.distinctIndices=function(t){for(var e={},n=0,i=t.length;n<i;n++){var o=""+t[n];e[o]=n}return[].concat(Object.keys(e))},t.mergeIndices=function(t){for(var n=[],i=0,o=t.length;i<o;i++){var s=t[i];if(1!==s.indices.length)throw new e(s);n[i]=s.indices[0]}return n},t.allOf=function(){for(var e=[],n=0;n<arguments.length;n++)e[n-0]=arguments[n];if("number"==typeof e[0]||"string"==typeof e[0]){var i=new t;i._allOfIndices=t.distinctIndices(e);return i}return t.allOf.apply(this,t.mergeIndices(e))},t.anyOf=function(){for(var e=[],n=0;n<arguments.length;n++)e[n-0]=arguments[n];if("number"==typeof e[0]||"string"==typeof e[0]){var i=new t;i._anyOfIndices=t.distinctIndices(e);return i}return t.anyOf.apply(this,t.mergeIndices(e))},t.appendIndices=function(t,e,n){var i=", ",o=t.length;t[o++]=e,t[o++]="(";for(var s=n.length-1,r=0,a=n.length;r<a;r++)t[o++]=""+n[r],r<s&&(t[o++]=i);t[o++]=")"},t.prototype.onEntityAdded=function(){return new n(this,i.OnEntityAdded)},t.prototype.onEntityRemoved=function(){return new n(this,i.OnEntityRemoved)},t.prototype.onEntityAddedOrRemoved=function(){return new n(this,i.OnEntityAddedOrRemoved)},t.uniqueId=0,t}();t.Matcher=o}(entitas||(entitas={}));var entitas;!function(t){"use strict";var e=t.utils.Signal,n=t.exceptions.EntityIsNotEnabledException,i=t.exceptions.EntityIsAlreadyReleasedException,o=t.exceptions.EntityAlreadyHasComponentException,s=t.exceptions.EntityDoesNotHaveComponentException,r=function(){function r(n,i){void 0===i&&(i=16),this.onEntityReleased=null,this.onComponentAdded=null,this.onComponentRemoved=null,this.onComponentReplaced=null,this.name="",this.id="",this.instanceIndex=0,this._creationIndex=0,this._isEnabled=!0,this._components=null,this._componentsCache=null,this._componentIndicesCache=null,this._toStringCache="",this._refCount=0,this._pool=null,this._componentsEnum=null,this.onEntityReleased=new e(this),this.onComponentAdded=new e(this),this.onComponentRemoved=new e(this),this.onComponentReplaced=new e(this),this._componentsEnum=n,this._pool=t.Pool.instance,this._components=this.initialize(i)}return Object.defineProperty(r.prototype,"creationIndex",{get:function(){return this._creationIndex},enumerable:!0,configurable:!0}),r.initialize=function(t,e){r.size=e.entities||100},r.dim=function(t,e){r.alloc=new Array(e);for(var n=0;n<e;n++){r.alloc[n]=new Array(t);for(var i=0;i<t;i++)r.alloc[n][i]=null}},r.prototype.initialize=function(t){var e,n=r.size;null==r.alloc&&r.dim(t,n);var i=r.alloc;if(this.instanceIndex=r.instanceIndex++,e=i[this.instanceIndex])return e;console.log("Insufficient memory allocation at ",this.instanceIndex,". Allocating ",n," entities.");for(var o=this.instanceIndex,s=o+n;o<s;o++){i[o]=new Array(t);for(var a=0;a<t;a++)i[o][a]=null}return e=i[this.instanceIndex]},r.prototype.addComponent=function(t,e){if(!this._isEnabled)throw new n("Cannot add component!");if(this.hasComponent(t)){var i="Cannot add component at index "+t+" to "+this;throw new o(i,t)}this._components[t]=e,this._componentsCache=null,this._componentIndicesCache=null,this._toStringCache=null;var s=this.onComponentAdded;return s.active&&s.dispatch(this,t,e),this},r.prototype.removeComponent=function(t){if(!this._isEnabled)throw new n("Cannot remove component!");if(!this.hasComponent(t)){var e="Cannot remove component at index "+t+" from "+this;throw new s(e,t)}return this._replaceComponent(t,null),this},r.prototype.replaceComponent=function(t,e){if(!this._isEnabled)throw new n("Cannot replace component!");return this.hasComponent(t)?this._replaceComponent(t,e):null!=e&&this.addComponent(t,e),this},r.prototype._replaceComponent=function(t,e){var n=this._components,i=n[t];if(i===e){var o=this.onComponentReplaced;o.active&&o.dispatch(this,t,i,e)}else if(n[t]=e,this._componentsCache=null,null==e){n[t]=null,this._componentIndicesCache=null,this._toStringCache=null;var s=this.onComponentRemoved;s.active&&s.dispatch(this,t,i)}else{var o=this.onComponentReplaced;o.active&&o.dispatch(this,t,i,e)}},r.prototype.getComponent=function(t){if(!this.hasComponent(t)){var e="Cannot get component at index "+t+" from "+this;throw new s(e,t)}return this._components[t]},r.prototype.getComponents=function(){if(null==this._componentsCache){for(var t=[],e=this._components,n=0,i=0,o=e.length;n<o;n++){var s=e[n];null!=s&&(t[i++]=s)}this._componentsCache=t}return this._componentsCache},r.prototype.getComponentIndices=function(){if(null==this._componentIndicesCache){for(var t=[],e=this._components,n=0,i=0,o=e.length;n<o;n++)null!=e[n]&&(t[i++]=n);this._componentIndicesCache=t}return this._componentIndicesCache},r.prototype.hasComponent=function(t){return null!=this._components[t]},r.prototype.hasComponents=function(t){for(var e=this._components,n=0,i=t.length;n<i;n++)if(null==e[t[n]])return!1;return!0},r.prototype.hasAnyComponent=function(t){for(var e=this._components,n=0,i=t.length;n<i;n++)if(null!=e[t[n]])return!0;return!1},r.prototype.removeAllComponents=function(){this._toStringCache=null;for(var t=this._components,e=0,n=t.length;e<n;e++)null!=t[e]&&this._replaceComponent(e,null)},r.prototype.destroy=function(){this.removeAllComponents(),this.onComponentAdded.clear(),this.onComponentReplaced.clear(),this.onComponentRemoved.clear(),this._isEnabled=!1},r.prototype.toString=function(){if(null==this._toStringCache){for(var t=[],e=", ",n=this.getComponents(),i=n.length-1,o=0,s=0,r=n.length;o<r;o++)t[s++]=n[o].constructor.name.replace("Component","")||o+"",o<i&&(t[s++]=e);this._toStringCache=t.join("")}return this._toStringCache},r.prototype.addRef=function(){return this._refCount+=1,this},r.prototype.release=function(){if(this._refCount-=1,0===this._refCount){var t=this.onEntityReleased;t.active&&t.dispatch(this)}else if(this._refCount<0)throw new i},r.instanceIndex=0,r.alloc=null,r.size=0,r}();t.Entity=r}(entitas||(entitas={}));var entitas;!function(t){"use strict";var e=t.utils.Signal,n=t.GroupEventType,i=t.exceptions.SingleEntityException,o=function(){function o(t){this.onEntityAdded=null,this.onEntityRemoved=null,this.onEntityUpdated=null,this._entities={},this._matcher=null,this._entitiesCache=null,this._singleEntityCache=null,this._toStringCache="",this._entities={},this.onEntityAdded=new e(this),this.onEntityRemoved=new e(this),this.onEntityUpdated=new e(this),this._matcher=t}return Object.defineProperty(o.prototype,"count",{get:function(){return Object.keys(this._entities).length},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"matcher",{get:function(){return this._matcher},enumerable:!0,configurable:!0}),o.prototype.createObserver=function(e){return void 0===e&&(e=n.OnEntityAdded),new t.GroupObserver(this,e)},o.prototype.handleEntitySilently=function(t){this._matcher.matches(t)?this.addEntitySilently(t):this.removeEntitySilently(t)},o.prototype.handleEntity=function(t,e,n){this._matcher.matches(t)?this.addEntity(t,e,n):this.removeEntity(t,e,n)},o.prototype.updateEntity=function(t,e,n,i){if(t.id in this._entities){var o=this.onEntityRemoved;o.active&&o.dispatch(this,t,e,n);var s=this.onEntityAdded;s.active&&s.dispatch(this,t,e,i);var r=this.onEntityUpdated;r.active&&r.dispatch(this,t,e,n,i)}},o.prototype.addEntitySilently=function(t){t.id in this._entities||(this._entities[t.id]=t,this._entitiesCache=null,this._singleEntityCache=null,t.addRef())},o.prototype.addEntity=function(t,e,n){if(!(t.id in this._entities)){this._entities[t.id]=t,this._entitiesCache=null,this._singleEntityCache=null,t.addRef();var i=this.onEntityAdded;i.active&&i.dispatch(this,t,e,n)}},o.prototype.removeEntitySilently=function(t){t.id in this._entities&&(delete this._entities[t.id],this._entitiesCache=null,this._singleEntityCache=null,t.release())},o.prototype.removeEntity=function(t,e,n){if(t.id in this._entities){delete this._entities[t.id],this._entitiesCache=null,this._singleEntityCache=null;var i=this.onEntityRemoved;i.active&&i.dispatch(this,t,e,n),t.release()}},o.prototype.containsEntity=function(t){return t.id in this._entities},o.prototype.getEntities=function(){if(null==this._entitiesCache)for(var t=this._entities,e=Object.keys(t),n=e.length,i=this._entitiesCache=new Array(n),o=0;o<n;o++)i[o]=t[e[o]];return this._entitiesCache},o.prototype.getSingleEntity=function(){if(null==this._singleEntityCache){var t=Object.keys(this._entities),e=t.length;if(1!==e){if(0===e)return null;throw new i(this._matcher)}this._singleEntityCache=this._entities[t[0]]}return this._singleEntityCache},o.prototype.toString=function(){return null==this._toStringCache&&(this._toStringCache="Group("+this._matcher+")"),this._toStringCache},o}();t.Group=o}(entitas||(entitas={}));var entitas;!function(t){"use strict";var e=t.GroupEventType,n=t.exceptions.GroupObserverException,i=function(){function t(t,e){var i=this;if(this._collectedEntities={},this._groups=null,this._eventTypes=null,this._addEntityCache=null,this.addEntity=function(t,e,n,o){e.id in i._collectedEntities||(i._collectedEntities[e.id]=e,e.addRef())},this._groups=Array.isArray(t)?t:[t],this._eventTypes=Array.isArray(e)?e:[e],t.length!==e.length)throw new n("Unbalanced count with groups ("+t.length+") and event types ("+e.length+")");this._collectedEntities={},this._addEntityCache=this.addEntity,this.activate()}return Object.defineProperty(t.prototype,"collectedEntities",{get:function(){return this._collectedEntities},enumerable:!0,configurable:!0}),t.prototype.activate=function(){for(var t=0,n=this._groups.length;t<n;t++){var i=this._groups[t],o=this._eventTypes[t];if(o===e.OnEntityAdded)i.onEntityAdded.remove(this._addEntityCache),i.onEntityAdded.add(this._addEntityCache);else if(o===e.OnEntityRemoved)i.onEntityRemoved.remove(this._addEntityCache),i.onEntityRemoved.add(this._addEntityCache);else{if(o!==e.OnEntityAddedOrRemoved)throw"Invalid eventType ["+typeof o+":"+o+"] in GroupObserver::activate";i.onEntityAdded.remove(this._addEntityCache),i.onEntityAdded.add(this._addEntityCache),i.onEntityRemoved.remove(this._addEntityCache),i.onEntityRemoved.add(this._addEntityCache)}}},t.prototype.deactivate=function(){for(var t=0,e=this._groups.length;t<e;t++){var n=this._groups[t];n.onEntityAdded.remove(this._addEntityCache),n.onEntityRemoved.remove(this._addEntityCache),this.clearCollectedEntities()}},t.prototype.clearCollectedEntities=function(){for(var t in this._collectedEntities)this._collectedEntities[t].release();this._collectedEntities={}},t}();t.GroupObserver=i}(entitas||(entitas={}));var entitas;!function(t){"use strict";function e(t,e){return e in t?t:null}var n=t.utils.UUID,i=t.utils.Bag,o=t.Group,s=t.Entity,r=t.utils.Signal,a=t.exceptions.EntityIsNotDestroyedException,c=t.exceptions.PoolDoesNotContainEntityException,u=function(){function u(t,e,n){var o=this;void 0===n&&(n=0),this.onEntityCreated=null,this.onEntityWillBeDestroyed=null,this.onEntityDestroyed=null,this.onGroupCreated=null,this.name="",this._entities={},this._groups={},this._groupsForIndex=null,this._reusableEntities=new i,this._retainedEntities={},this._componentsEnum=null,this._totalComponents=0,this._creationIndex=0,this._entitiesCache=null,this.updateGroupsComponentAddedOrRemoved=function(t,e,n){var i=o._groupsForIndex[e];if(null!=i)for(var s=0,r=i.size();s<r;s++)i[s].handleEntity(t,e,n)},this.updateGroupsComponentReplaced=function(t,e,n,i){var s=o._groupsForIndex[e];if(null!=s)for(var r=0,a=s.size();r<a;r++)s[r].updateEntity(t,e,n,i)},this.onEntityReleased=function(t){if(t._isEnabled)throw new a("Cannot release entity.");t.onEntityReleased.remove(o._cachedOnEntityReleased),delete o._retainedEntities[t.id],o._reusableEntities.add(t)},u.instance=this,this.onGroupCreated=new r(this),this.onEntityCreated=new r(this),this.onEntityDestroyed=new r(this),this.onEntityWillBeDestroyed=new r(this),this._componentsEnum=t,this._totalComponents=e,this._creationIndex=n,this._groupsForIndex=new i,this._cachedUpdateGroupsComponentAddedOrRemoved=this.updateGroupsComponentAddedOrRemoved,this._cachedUpdateGroupsComponentReplaced=this.updateGroupsComponentReplaced,this._cachedOnEntityReleased=this.onEntityReleased,u.componentsEnum=t,u.totalComponents=e}return Object.defineProperty(u.prototype,"totalComponents",{get:function(){return this._totalComponents},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"count",{get:function(){return Object.keys(this._entities).length},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"reusableEntitiesCount",{get:function(){return this._reusableEntities.size()},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"retainedEntitiesCount",{get:function(){return Object.keys(this._retainedEntities).length},enumerable:!0,configurable:!0}),u.setPool=function(t,n){var i=e(t,"setPool");null!=i&&i.setPool(n)},u.prototype.createEntity=function(t){var e=this._reusableEntities.size()>0?this._reusableEntities.removeLast():new s(this._componentsEnum,this._totalComponents);e._isEnabled=!0,e.name=t,e._creationIndex=this._creationIndex++,e.id=n.randomUUID(),e.addRef(),this._entities[e.id]=e,this._entitiesCache=null,e.onComponentAdded.add(this._cachedUpdateGroupsComponentAddedOrRemoved),e.onComponentRemoved.add(this._cachedUpdateGroupsComponentAddedOrRemoved),e.onComponentReplaced.add(this._cachedUpdateGroupsComponentReplaced),e.onEntityReleased.add(this._cachedOnEntityReleased);var i=this.onEntityCreated;return i.active&&i.dispatch(this,e),e},u.prototype.destroyEntity=function(t){if(!(t.id in this._entities))throw new c(t,"Could not destroy entity!");delete this._entities[t.id],this._entitiesCache=null;var e=this.onEntityWillBeDestroyed;e.active&&e.dispatch(this,t),t.destroy();var n=this.onEntityDestroyed;n.active&&n.dispatch(this,t),1===t._refCount?(t.onEntityReleased.remove(this._cachedOnEntityReleased),this._reusableEntities.add(t)):this._retainedEntities[t.id]=t,t.release()},u.prototype.destroyAllEntities=function(){for(var t=this.getEntities(),e=0,n=t.length;e<n;e++)this.destroyEntity(t[e])},u.prototype.hasEntity=function(t){return t.id in this._entities},u.prototype.getEntities=function(t){if(t)return this.getGroup(t).getEntities();if(null==this._entitiesCache)for(var e=this._entities,n=Object.keys(e),i=n.length,o=this._entitiesCache=new Array(i),s=0;s<i;s++)o[s]=e[n[s]];return this._entitiesCache},u.prototype.createSystem=function(n){if("function"==typeof n){var i=n;n=new i}u.setPool(n,this);var o=e(n,"trigger");if(null!=o)return new t.ReactiveSystem(this,o);var s=e(n,"triggers");return null!=s?new t.ReactiveSystem(this,s):n},u.prototype.getGroup=function(t){var e;if(t.id in this._groups)e=this._groups[t.id];else{e=new o(t);for(var n=this.getEntities(),s=0,r=n.length;s<r;s++)e.handleEntitySilently(n[s]);this._groups[t.id]=e;for(var s=0,a=t.indices.length;s<a;s++){var c=t.indices[s];null==this._groupsForIndex[c]&&(this._groupsForIndex[c]=new i),this._groupsForIndex[c].add(e)}var u=this.onGroupCreated;u.active&&u.dispatch(this,e)}return e},u.componentsEnum=null,u.totalComponents=0,u.instance=null,u}();t.Pool=u}(entitas||(entitas={}));var entitas;!function(t){"use strict";function e(t,e){return e in t?t:null}var n=t.GroupObserver,i=function(){function t(t,i){var o="triggers"in i?i.triggers:[i.trigger];this._subsystem=i;var s=e(i,"ensureComponents");null!=s&&(this._ensureComponents=s.ensureComponents);var r=e(i,"excludeComponents");null!=r&&(this._excludeComponents=r.excludeComponents),this._clearAfterExecute=null!=e(i,"clearAfterExecute");for(var a=o.length,c=new Array(a),u=new Array(a),h=0;h<a;h++){var l=o[h];c[h]=t.getGroup(l.trigger),u[h]=l.eventType}this._observer=new n(c,u),this._buffer=[]}return Object.defineProperty(t.prototype,"subsystem",{get:function(){return this._subsystem},enumerable:!0,configurable:!0}),t.prototype.activate=function(){this._observer.activate()},t.prototype.deactivate=function(){this._observer.deactivate()},t.prototype.clear=function(){this._observer.clearCollectedEntities()},t.prototype.execute=function(){var t=this._observer.collectedEntities,e=this._ensureComponents,n=this._excludeComponents,i=this._buffer,o=i.length;if(0!=Object.keys(t).length){if(e)if(n)for(var s in t){var r=t[s];e.matches(r)&&!n.matches(r)&&(i[o++]=r.addRef())}else for(var s in t){var r=t[s];e.matches(r)&&(i[o++]=r.addRef())}else if(n)for(var s in t){var r=t[s];n.matches(r)||(i[o++]=r.addRef())}else for(var s in t){var r=t[s];i[o++]=r.addRef()}if(this._observer.clearCollectedEntities(),0!=i.length){this._subsystem.execute(i);for(var a=0,c=i.length;a<c;a++)i[a].release();i.length=0,this._clearAfterExecute&&this._observer.clearCollectedEntities()}}},t}();t.ReactiveSystem=i}(entitas||(entitas={}));var entitas;!function(t){"use strict";function e(t,e){return e in t?t:null}var n=function(){function t(){this._initializeSystems=[],this._executeSystems=[]}return t.prototype.add=function(t){if("function"==typeof t){var n=t;t=new n}var i=e(t,"subsystem"),o=null!=i?e(i.subsystem,"initialize"):e(t,"initialize");if(null!=o){var s=this._initializeSystems;s[s.length]=o}var r=e(t,"execute");if(null!=r){var a=this._executeSystems;a[a.length]=r}return this},t.prototype.initialize=function(){for(var t=0,e=this._initializeSystems.length;t<e;t++)this._initializeSystems[t].initialize()},t.prototype.execute=function(){for(var t=this._executeSystems,e=0,n=t.length;e<n;e++)t[e].execute()},t.prototype.clearReactiveSystems=function(){for(var t=0,n=this._executeSystems.length;t<n;t++){var i=e(this._executeSystems[t],"subsystem");null!=i&&i.clear();var o=e(this._executeSystems[t],"clearReactiveSystems");null!=o&&o.clearReactiveSystems()}},t}();t.Systems=n}(entitas||(entitas={}));var entitas;!function(t){var e;!function(e){var n=t.Systems,i=t.viewer.EntityBehavior,o=t.viewer.SystemObserver,s=t.viewer.PoolObserver,r=function(){function t(){}return t.init=function(r){function a(){return"Systems  ("+this._initializeSystems.length+" init, "+this._executeSystems.length+" exe "}if("?debug=true"===location.search&&window.dat){e.gui=new dat.GUI({height:159,width:300});var c=new s(r);t._controllers={},t._entities=e.gui.addFolder("Entities"),t._pools=e.gui.addFolder("Pools"),t._systems=e.gui.addFolder("Systems"),t._entities.open(),t._pools.open(),t._systems.open(),t._pools.add(c,"entities").listen(),t._pools.add(c,"reusable").listen(),r.onEntityCreated.add(function(e,n){var o=new i(n);t._controllers[n.id]=t._entities.add(o,o.name).listen()}),r.onEntityDestroyed.add(function(e,n){var i=t._controllers[n.id];delete t._controllers[n.id],t._entities.remove(i)}),n.prototype.initialize=function(){for(var e=0,n=this._initializeSystems.length;e<n;e++)this._initializeSystems[e].initialize();var i=new o(this);t._systems.add(i,"initialize").listen(),t._systems.add(i,"execute").listen()},Object.defineProperty(n.prototype,"name",{get:function(){return"Systems"}}),Object.defineProperty(n.prototype,"Systems",{get:a})}},t}();e.VisualDebugging=r}(e=t.viewer||(t.viewer={}))}(entitas||(entitas={}));var entitas;!function(t){var e;!function(t){var e=function(){function t(t){var e=this;this.obj=t,this.obj.name?this._name=this.obj.name:this._name="Entity_"+this.obj._creationIndex,Object.defineProperty(this,this._name,{get:function(){return e.obj.toString()}})}return Object.defineProperty(t.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),t}();t.EntityBehavior=e}(e=t.viewer||(t.viewer={}))}(entitas||(entitas={}));var entitas;!function(t){var e;!function(t){var e=function(){function t(t){this._pool=t,this._groups=this._pool._groups;
}return Object.defineProperty(t.prototype,"name",{get:function(){return"Pool"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Pool",{get:function(){return"Pool  ("+this._pool.count+" entities, "+this._pool.reusableEntitiesCount+" reusable, "+Object.keys(this._groups).length+" groups)"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"entities",{get:function(){return this._pool.count},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"reusable",{get:function(){return this._pool.reusableEntitiesCount},enumerable:!0,configurable:!0}),t}();t.PoolObserver=e}(e=t.viewer||(t.viewer={}))}(entitas||(entitas={}));var entitas;!function(t){var e;!function(t){var e=function(){function t(t){this._systems=t}return Object.defineProperty(t.prototype,"name",{get:function(){return"Systems"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Systems",{get:function(){return"Systems  ("+this._systems._initializeSystems.length+" init, "+this._systems._executeSystems.length+" exe "},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"initialize",{get:function(){return this._systems._initializeSystems.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"execute",{get:function(){return this._systems._executeSystems.length},enumerable:!0,configurable:!0}),t}();t.SystemObserver=e}(e=t.viewer||(t.viewer={}))}(entitas||(entitas={}));