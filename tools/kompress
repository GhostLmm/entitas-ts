#!/usr/bin/env coffee
fs = require('fs')
path = require('path')
entitas = require('../entitas.json')
words = [] #fs.readFileSync('./tools/words.txt', 'utf8').split('\n')
for system of entitas.systems
  words.push system
for Name of entitas.components
  name = Name[0].toLowerCase()+Name[1...];
  words.push "#{Name}Component"
  words.push "#{name}Component"
  words.push "set#{Name}Component"
  words.push "#{Name}Component"
  words.push "_#{name}ComponentPool"
  words.push "clear#{Name}ComponentPool"

words.sort (a,b) -> b.length - a.length;
console.log words
js = fs.readFileSync('./build/web/example1.js', 'utf8')
console.log words.length, js.length

j = 0
t = 0
for word in words
  continue if word is 'setPosition'

  r = new RegExp("\\b#{word}\\b","g")
  m = js.match(r)
  if m isnt null then l = m.length else l=0
  t += l
  if l > 0
    console.log word, (words.length-j).toString(36)
    # convert base
    js = js.replace(r, '_'+(words.length-j++).toString(36))


console.log 'total', t, 'length', js.length
fs.writeFileSync('./build/web/example3.js', js)